# GitHub Integration Guide

## Overview

PrismCode natively integrates with GitHub to automate:
- Issue creation (Epics, Stories, Tasks)
- Project board management
- Label and milestone assignment
- Pull request workflows
- CI/CD via GitHub Actions

## Setup

### 1. Generate GitHub Personal Access Token

1. Go to [GitHub Settings → Developer settings → Personal access tokens](https://github.com/settings/tokens)
2. Click "Generate new token (classic)"
3. Select scopes:
   - ✅ `repo` (Full control of private repositories)
   - ✅ `workflow` (Update GitHub Actions workflows)
   - ✅ `project` (Full control of projects)
   - ✅ `write:discussion` (Write access to discussions)
4. Generate and copy token
5. Add to `.env`:

```env
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxx
```

### 2. Configure Repository

Edit `.prismcode.config.json`:

```json
{
  "github": {
    "owner": "pkurri",
    "repo": "my-project",
    "defaultLabels": ["feature", "bug", "enhancement"],
    "useProjects": true,
    "projectId": "PVT_kwDOxxxxxx"
  }
}
```

## Features

### Automated Issue Creation

#### From JSON Payload

```bash
# Generate issues JSON
npm run plan -- --feature "User authentication" --output-format json

# Import to GitHub
node scripts/import-issues.js output/github-issues.json
```

#### Direct Creation

```bash
npm run plan -- --feature "User authentication" --create-issues
```

### Issue Templates

PrismCode generates issues using templates in `.github/ISSUE_TEMPLATE/`:

- `epic.md` - Strategic initiatives
- `story.md` - User-facing features
- `task.md` - Implementation work
- `bug.md` - Bug reports

### Label Management

#### Auto-Labeling

Issues are automatically labeled based on:
- Issue type (`epic`, `story`, `task`)
- Technical area (`frontend`, `backend`, `database`)
- Priority (`priority:high`, `priority:medium`, `priority:low`)
- Size (`size:S`, `size:M`, `size:L`, `size:XL`)

#### Custom Labels

Define in config:

```json
{
  "github": {
    "labels": {
      "epic": {"color": "7C3AED", "description": "Strategic initiative"},
      "story": {"color": "06B6D4", "description": "User story"},
      "priority:high": {"color": "D73A4A", "description": "High priority"}
    }
  }
}
```

### GitHub Projects Integration

#### Project Board Setup

1. Create GitHub Project (v2)
2. Get project ID:

```bash
gh project list --owner pkurri
```

3. Add to config:

```json
{
  "github": {
    "projectId": "PVT_kwDOxxxxxx",
    "customFields": {
      "Priority": ["P0", "P1", "P2", "P3"],
      "Size": ["XS", "S", "M", "L", "XL"],
      "Sprint": "text",
      "Status": ["Backlog", "Todo", "In Progress", "Review", "Done"]
    }
  }
}
```

#### Auto-Add to Project

When creating issues with `--create-issues`, they're automatically added to your project board.

### Milestone Management

Assign issues to milestones:

```bash
npm run plan -- \
  --feature "Q1 Features" \
  --milestone "Q1 2025" \
  --create-issues
```

### Dependency Linking

Issues automatically reference dependencies:

```markdown
## Dependencies
- Depends on: #123
- Blocks: #456, #789
```

### GitHub Actions Integration

PrismCode generates `.github/workflows/` files:

#### CI Pipeline

```yaml
# Auto-generated by PrismCode
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - run: npm test
```

#### Auto-Labeling Workflow

```yaml
name: Auto Label Issues
on:
  issues:
    types: [opened]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@v4
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
```

### Pull Request Automation

#### PR Templates

Generated `.github/pull_request_template.md`:

```markdown
## Description

## Related Issues
Closes #

## Type of Change
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change

## Checklist
- [ ] Tests pass
- [ ] Documentation updated
- [ ] Code reviewed
```

#### Auto-Link Issues

PRs automatically link to issues using keywords:
- `Closes #123`
- `Fixes #456`
- `Resolves #789`

## Advanced Usage

### GraphQL API

For complex queries, use GitHub's GraphQL API:

```typescript
import { graphql } from '@octokit/graphql';

const { repository } = await graphql(
  `
    query($owner: String!, $repo: String!) {
      repository(owner: $owner, name: $repo) {
        issues(first: 100, states: OPEN) {
          nodes {
            id
            title
            labels(first: 10) {
              nodes {
                name
              }
            }
          }
        }
      }
    }
  `,
  {
    owner: 'pkurri',
    repo: 'prismcode',
    headers: {
      authorization: `token ${process.env.GITHUB_TOKEN}`,
    },
  }
);
```

### Multi-Repo Management

Manage multiple repositories:

```json
{
  "github": {
    "repositories": [
      {
        "owner": "pkurri",
        "repo": "frontend-app",
        "labels": ["frontend", "react"]
      },
      {
        "owner": "pkurri",
        "repo": "backend-api",
        "labels": ["backend", "node"]
      }
    ]
  }
}
```

```bash
npm run plan -- \
  --feature "Shared authentication" \
  --repos "frontend-app,backend-api" \
  --create-issues
```

### Webhooks

Set up webhooks for real-time updates:

1. Go to Repository Settings → Webhooks
2. Add webhook URL (e.g., n8n webhook)
3. Select events: `issues`, `pull_request`, `project_card`
4. PrismCode can process webhook payloads

## Troubleshooting

### Token Permission Errors

**Error**: `Resource not accessible by integration`

**Solution**: Regenerate token with all required scopes.

### Rate Limiting

**Error**: `API rate limit exceeded`

**Solution**: 
- Authenticated requests: 5,000/hour
- Use GraphQL for bulk operations
- Implement request batching

### Project ID Not Found

**Error**: `Could not resolve to a Project`

**Solution**: Get correct ID:

```bash
gh project list --owner pkurri --format json | jq '.projects[] | {name: .title, id: .id}'
```

## Best Practices

1. **Use Draft Issues**: Create drafts first, review, then publish
2. **Consistent Labeling**: Define label schema upfront
3. **Link Dependencies**: Always specify issue relationships
4. **Milestone Planning**: Group related work in milestones
5. **Automate Repetitive Tasks**: Use GitHub Actions for workflows
6. **Regular Cleanup**: Archive completed projects, close stale issues

## Resources

- [GitHub REST API Docs](https://docs.github.com/en/rest)
- [GitHub GraphQL API Docs](https://docs.github.com/en/graphql)
- [GitHub Actions Docs](https://docs.github.com/en/actions)
- [Octokit.js](https://github.com/octokit/octokit.js)